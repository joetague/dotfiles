#!/bin/bash
# Bash wrappers for docker run commands
# Heavily influenced by the great Jessie Frazelle see: https://github.com/jessfraz/dotfiles/blob/master/.dockerfunc

export DOCKER_REPO_PREFIX=joetague

#
# Helper Functions
#
dcleanup(){
    docker container prune -f >/dev/null 2>&1
    local volumes
    mapfile -t volumes < <(docker volume ls -qf dangling=true 2>/dev/null)
    if [[ ${#volumes[@]} -gt 0 ]]; then
        docker volume rm "${volumes[@]}" 2>/dev/null
    fi
    local images
    mapfile -t images < <(docker images --filter dangling=true -q 2>/dev/null)
    if [[ ${#images[@]} -gt 0 ]]; then
        docker rmi "${images[@]}" 2>/dev/null
    fi
}
del_stopped(){
    local name=$1
    local state
    state=$(docker inspect --format "{{.State.Running}}" "$name" 2>/dev/null)
    if [[ -z "$state" ]]; then
        return 0
    fi

    if [[ "$state" == "false" ]]; then
        docker rm "$name"
    fi
}
#
# Container Aliases
#
notebooks(){
    del_stopped notebooks

    docker run --rm \
           -v "${HOME}/proj/notebooks:/home/jovyan/work" \
           -v "${HOME}/proj/data:/home/jovyan/data" \
           -p 8888:8888 \
           -p 4040-4050:4040-4050 \
           --name notebooks \
           quay.io/jupyter/all-spark-notebook:2026-01-12 "$@"
}
